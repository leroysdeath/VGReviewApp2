function t(t){return"object"==typeof t&&null!==t&&"t"in t}function e(t,e,i,r,n,s){return Oe(this,void 0,void 0,function*(){return new Promise((o,l)=>{t(i,((t,e,i,r)=>{const n={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"!==t&&r?((t=>{if("object"!=typeof t||null===t)return!1;const e=Object.getPrototypeOf(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)})(r)?(n.headers=Object.assign({"Content-Type":"application/json"},null==e?void 0:e.headers),n.body=JSON.stringify(r)):n.body=r,(null==e?void 0:e.duplex)&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),i)):n})(e,r,n,s)).then(t=>{if(!t.ok)throw t;return(null==r?void 0:r.noResolveJson)?t:t.json()}).then(t=>o(t)).catch(t=>((t,e,i)=>Oe(void 0,void 0,void 0,function*(){const r=yield(n=void 0,s=function*(){return"undefined"==typeof Response?(yield C(()=>Promise.resolve().then(()=>tt),void 0)).Response:Response},new(n||(n=Promise))((t,e)=>{function i(t){try{o(s.next(t))}catch(i){e(i)}}function r(t){try{o(s.throw(t))}catch(i){e(i)}}function o(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n(t=>{t(s)})).then(i,r)}o((s=s.apply(void 0,[])).next())}));var n,s;t instanceof r&&!(null==i?void 0:i.noResolveJson)?t.json().then(i=>{const r=t.status||500,n=(null==i?void 0:i.statusCode)||r+"";e(new _e(Se(i),r,n))}).catch(t=>{e(new $e(Se(t),t))}):e(new $e(Se(t),t))}))(t,l,r))})})}function i(t,i,r,n){return Oe(this,void 0,void 0,function*(){return e(t,"GET",i,r,n)})}function r(t,i,r,n,s){return Oe(this,void 0,void 0,function*(){return e(t,"POST",i,n,s,r)})}function n(t,i,r,n,s){return Oe(this,void 0,void 0,function*(){return e(t,"PUT",i,n,s,r)})}function s(t,i,r,n,s){return Oe(this,void 0,void 0,function*(){return e(t,"DELETE",i,n,s,r)})}function o(t){return"object"==typeof t&&null!==t&&"i"in t}function l(t){return o(t)&&"AuthRetryableFetchError"===t.name}function h(t,e,i){if(null!==t)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;i(ni[t]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;i(ni[t]),e.queuedBits-=6}}function u(t,e,i){const r=oi[t];if(-1>=r){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)i(e.queue>>e.queuedBits-8&255),e.queuedBits-=8}function a(t){const e=[],i=t=>{e.push(String.fromCodePoint(t))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},s=t=>{((t,e,i)=>{if(0===e.utf8seq){if(127>=t)return void i(t);for(let i=1;6>i;i+=1)if(!(t>>7-i&1)){e.utf8seq=i;break}if(2===e.utf8seq)e.codepoint=31&t;else if(3===e.utf8seq)e.codepoint=15&t;else{if(4!==e.utf8seq)throw new Error("Invalid UTF-8 sequence");e.codepoint=7&t}e.utf8seq-=1}else if(e.utf8seq>0){if(127>=t)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|63&t,e.utf8seq-=1,0===e.utf8seq&&i(e.codepoint)}})(t,r,i)};for(let o=0;o<t.length;o+=1)u(t.charCodeAt(o),n,s);return e.join("")}function c(t,e){if(t>127){if(2047>=t)return e(192|t>>6),void e(128|63&t);if(65535>=t)return e(224|t>>12),e(128|t>>6&63),void e(128|63&t);if(1114111>=t)return e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),void e(128|63&t);throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}e(t)}function d(t){const e=[],i={queue:0,queuedBits:0},r=t=>{e.push(t)};for(let n=0;n<t.length;n+=1)u(t.charCodeAt(n),i,r);return new Uint8Array(e)}function f(t){const e=[],i={queue:0,queuedBits:0},r=t=>{e.push(t)};return t.forEach(t=>h(t,i,r)),h(null,i,r),e.join("")}function v(t){const e=t.split(".");if(3!==e.length)throw new ri("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!qe.test(e[i]))throw new ri("JWT not in base64url format");return{header:JSON.parse(a(e[0])),payload:JSON.parse(a(e[1])),signature:d(e[2]),raw:{header:e[0],payload:e[1]}}}function y(t){return("0"+t.toString(16)).substr(-2)}function p(t,e,i=!1){return R(this,null,function*(){const r=(()=>{const t=new Uint32Array(56);if("undefined"==typeof crypto){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=t.length;let i="";for(let r=0;56>r;r++)i+=t.charAt(Math.floor(Math.random()*e));return i}return crypto.getRandomValues(t),Array.from(t,y).join("")})();let n=r;i&&(n+="/PASSWORD_RECOVERY"),yield ci(t,`${e}-code-verifier`,n);const s=yield function(t){return R(this,null,function*(){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return t;const e=yield function(t){return R(this,null,function*(){const e=(new TextEncoder).encode(t),i=yield crypto.subtle.digest("SHA-256",e),r=new Uint8Array(i);return Array.from(r).map(t=>String.fromCharCode(t)).join("")})}(t);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}(r);return[s,r===s?"plain":"s256"]})}function w(t){if(!pi.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function b(){return new Proxy({},{get(t,e){if("__isUserNotAvailableProxy"===e)return!0;if("symbol"==typeof e){const t=e.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set(t,e){throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty(t,e){throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function g(t){return JSON.parse(JSON.stringify(t))}function m(t){return R(this,null,function*(){var e,i;if(!("object"==typeof(i=t)&&null!==i&&"status"in i&&"ok"in i&&"json"in i&&"function"==typeof i.json))throw new ei(wi(t),0);if(bi.includes(t.status))throw new ei(wi(t),t.status);let r,n;try{r=yield t.json()}catch(o){throw new Ve(wi(o),o)}const s=(t=>{const e=t.headers.get(Me);if(!e)return null;if(!e.match(yi))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch(o){return null}})(t);if(s&&s.getTime()>=Ge.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?n=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(n=r.error_code),n){if("weak_password"===n)throw new ii(wi(r),t.status,(null===(e=r.weak_password)||void 0===e?void 0:e.reasons)||[]);if("session_not_found"===n)throw new Ye}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0))throw new ii(wi(r),t.status,r.weak_password.reasons);throw new He(wi(r),t.status||500,n)})}function _(t,e,i,r){return R(this,null,function*(){var n;const s=Object.assign({},null==r?void 0:r.headers);s[Me]||(s[Me]=Ge.name),(null==r?void 0:r.jwt)&&(s.Authorization=`Bearer ${r.jwt}`);const o=null!==(n=null==r?void 0:r.query)&&void 0!==n?n:{};(null==r?void 0:r.redirectTo)&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",h=yield function(t,e,i,r,n,s){return R(this,null,function*(){const o=((t,e,i,r)=>{const n={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"===t?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==e?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),i))})(e,r,n,s);let l;try{l=yield t(i,Object.assign({},o))}catch(h){throw new ei(wi(h),0)}if(l.ok||(yield m(l)),null==r?void 0:r.noResolveJson)return l;try{return yield l.json()}catch(h){yield m(h)}})}(t,e,i+l,{headers:s,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(h):{data:Object.assign({},h),error:null}})}function $(t){var e;let i=null;var r;return(t=>t.access_token&&t.refresh_token&&t.expires_in)(t)&&(i=Object.assign({},t),t.expires_at||(i.expires_at=(r=t.expires_in,Math.round(Date.now()/1e3)+r))),{data:{session:i,user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function j(t){const e=$(t);return!e.error&&t.weak_password&&"object"==typeof t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&"string"==typeof t.weak_password.message&&t.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0)&&(e.data.weak_password=t.weak_password),e}function k(t){var e;return{data:{user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function O(t){return{data:t,error:null}}function S(t){const{action_link:e,email_otp:i,hashed_token:r,redirect_to:n,verification_type:s}=t,o=((t,e)=>{var i={};for(var r in t)({}).hasOwnProperty.call(t,r)&&0>e.indexOf(r)&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(t);n<r.length;n++)0>e.indexOf(r[n])&&{}.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]])}return i})(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:e,email_otp:i,hashed_token:r,redirect_to:n,verification_type:s},user:Object.assign({},o)},error:null}}function T(t){return t}function E(t={}){return{getItem(e){return t[e]||null},setItem(e,i){t[e]=i},removeItem(e){delete t[e]}}}function x(t,e,i){return R(this,null,function*(){const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort()},e),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(t,0===e?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},r=>R(this,null,function*(){if(!r){if(0===e)throw new ji(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(_i)try{yield globalThis.navigator.locks.query()}catch(n){}return yield i()}try{return yield i()}finally{}})))})}function A(t,e,i){return R(this,null,function*(){return yield i()})}var I,P,R=(t,e,i)=>new Promise((r,n)=>{var s=t=>{try{l(i.next(t))}catch(e){n(e)}},o=t=>{try{l(i.throw(t))}catch(e){n(e)}},l=t=>t.done?r(t.value):Promise.resolve(t.value).then(s,o);l((i=i.apply(t,e)).next())});import{n as U,o as N}from"./vendor-misc-CV86-oMF.js";import{_ as C}from"./app-components-DqcxH7V0.js";class D extends Error{constructor(t,e="FunctionsError",i){super(t),this.name=e,this.context=i}}class L extends D{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class B extends D{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class F extends D{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}(P=I||(I={})).Any="any",P.ApNortheast1="ap-northeast-1",P.ApNortheast2="ap-northeast-2",P.ApSouth1="ap-south-1",P.ApSoutheast1="ap-southeast-1",P.ApSoutheast2="ap-southeast-2",P.CaCentral1="ca-central-1",P.EuCentral1="eu-central-1",P.EuWest1="eu-west-1",P.EuWest2="eu-west-2",P.EuWest3="eu-west-3",P.SaEast1="sa-east-1",P.UsEast1="us-east-1",P.UsWest1="us-west-1",P.UsWest2="us-west-2";class J{constructor(t,{headers:e={},customFetch:i,region:r=I.Any}={}){this.url=t,this.headers=e,this.region=r,this.fetch=(t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>C(()=>R(void 0,null,function*(){const{default:t}=yield Promise.resolve().then(()=>tt);return{default:t}}),void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)})(i)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,e={}){var i,r,n,s;return r=this,s=function*(){try{const{headers:r,method:n,body:s}=e;let o={},{region:l}=e;l||(l=this.region);const h=new URL(`${this.url}/${t}`);let u;l&&"any"!==l&&(o["x-region"]=l,h.searchParams.set("forceFunctionRegion",l)),s&&(r&&!{}.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&s instanceof Blob||s instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",u=s):"string"==typeof s?(o["Content-Type"]="text/plain",u=s):"undefined"!=typeof FormData&&s instanceof FormData?u=s:(o["Content-Type"]="application/json",u=JSON.stringify(s)));const a=yield this.fetch(h.toString(),{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),r),body:u}).catch(t=>{throw new L(t)}),c=a.headers.get("x-relay-error");if(c&&"true"===c)throw new B(a);if(!a.ok)throw new F(a);let d,f=(null!==(i=a.headers.get("Content-Type"))&&void 0!==i?i:"text/plain").split(";")[0].trim();return d="application/json"===f?yield a.json():"application/octet-stream"===f?yield a.blob():"text/event-stream"===f?a:"multipart/form-data"===f?yield a.formData():yield a.text(),{data:d,error:null,response:a}}catch(r){return{data:null,error:r,response:r instanceof F||r instanceof B?r.context:void 0}}},new((n=void 0)||(n=Promise))((t,e)=>{function i(t){try{l(s.next(t))}catch(i){e(i)}}function o(t){try{l(s.throw(t))}catch(i){e(i)}}function l(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n(t=>{t(r)})).then(i,o)}l((s=s.apply(r,[])).next())})}}var W={},M={},G={},q={},z={},H={},V=(()=>{if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")})();const K=V.fetch,Y=V.fetch.bind(V),X=V.Headers,Q=V.Request,Z=V.Response,tt=Object.freeze(Object.defineProperty({__proto__:null,Headers:X,Request:Q,Response:Z,default:Y,fetch:K},Symbol.toStringTag,{value:"Module"})),et=U(tt);var it={};Object.defineProperty(it,"o",{value:!0});let rt=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};it.default=rt;var nt=N&&N.l||(t=>t&&t.o?t:{default:t});Object.defineProperty(H,"o",{value:!0});const st=nt(et),ot=nt(it);H.default=class{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:"undefined"==typeof fetch?this.fetch=st.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=Object.assign({},this.headers),this.headers[t]=e,this}then(t,e){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let i=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(t=>R(this,null,function*(){var e,i,r;let n=null,s=null,o=null,l=t.status,h=t.statusText;if(t.ok){if("HEAD"!==this.method){const e=yield t.text();""===e||(s="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?e:JSON.parse(e))}const r=null===(e=this.headers.Prefer)||void 0===e?void 0:e.match(/count=(exact|planned|estimated)/),u=null===(i=t.headers.get("content-range"))||void 0===i?void 0:i.split("/");r&&u&&u.length>1&&(o=parseInt(u[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(s)&&(s.length>1?(n={code:"PGRST116",details:`Results contain ${s.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},s=null,o=null,l=406,h="Not Acceptable"):s=1===s.length?s[0]:null)}else{const e=yield t.text();try{n=JSON.parse(e),Array.isArray(n)&&404===t.status&&(s=[],n=null,l=200,h="OK")}catch(u){404===t.status&&""===e?(l=204,h="No Content"):n={message:e}}if(n&&this.isMaybeSingle&&(null===(r=null==n?void 0:n.details)||void 0===r?void 0:r.includes("0 rows"))&&(n=null,l=200,h="OK"),n&&this.shouldThrowOnError)throw new ot.default(n)}return{error:n,data:s,count:o,status:l,statusText:h}}));return this.shouldThrowOnError||(i=i.catch(t=>{var e,i,r;return{error:{message:`${null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"FetchError"}: ${null==t?void 0:t.message}`,details:`${null!==(i=null==t?void 0:t.stack)&&void 0!==i?i:""}`,hint:"",code:`${null!==(r=null==t?void 0:t.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}})),i.then(t,e)}returns(){return this}overrideTypes(){return this}};var lt=N&&N.l||(t=>t&&t.o?t:{default:t});Object.defineProperty(z,"o",{value:!0});const ht=lt(H);let ut=class extends ht.default{select(t){let e=!1;const i=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!e?"":('"'===t&&(e=!e),t)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t,{ascending:e=!0,nullsFirst:i,foreignTable:r,referencedTable:n=r}={}){const s=n?`${n}.order`:"order",o=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${void 0===i?"":i?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:i=e}={}){const r=void 0===i?"limit":`${i}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:i,referencedTable:r=i}={}){const n=void 0===r?"offset":`${r}.offset`,s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${t}`),this.url.searchParams.set(s,""+(e-t+1)),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:t=!1,verbose:e=!1,settings:i=!1,buffers:r=!1,wal:n=!1,format:s="text"}={}){var o;const l=[t?"analyze":null,e?"verbose":null,i?"settings":null,r?"buffers":null,n?"wal":null].filter(Boolean).join("|"),h=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${s}; for="${h}"; options=${l};`,this}rollback(){var t;return(null!==(t=this.headers.Prefer)&&void 0!==t?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};z.default=ut;var at=N&&N.l||(t=>t&&t.o?t:{default:t});Object.defineProperty(q,"o",{value:!0});const ct=at(z);let dt=class extends ct.default{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}in(t,e){const i=Array.from(new Set(e)).map(t=>"string"==typeof t&&new RegExp("[,()]").test(t)?`"${t}"`:`${t}`).join(",");return this.url.searchParams.append(t,`in.(${i})`),this}contains(t,e){return"string"==typeof e?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return"string"==typeof e?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return"string"==typeof e?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:i,type:r}={}){let n="";"plain"===r?n="pl":"phrase"===r?n="ph":"websearch"===r&&(n="w");const s=void 0===i?"":`(${i})`;return this.url.searchParams.append(t,`${n}fts${s}.${e}`),this}match(t){return Object.entries(t).forEach(([t,e])=>{this.url.searchParams.append(t,`eq.${e}`)}),this}not(t,e,i){return this.url.searchParams.append(t,`not.${e}.${i}`),this}or(t,{foreignTable:e,referencedTable:i=e}={}){const r=i?`${i}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,i){return this.url.searchParams.append(t,`${e}.${i}`),this}};q.default=dt;var ft=N&&N.l||(t=>t&&t.o?t:{default:t});Object.defineProperty(G,"o",{value:!0});const vt=ft(q);G.default=class{constructor(t,{headers:e={},schema:i,fetch:r}){this.url=t,this.headers=e,this.schema=i,this.fetch=r}select(t,{head:e=!1,count:i}={}){const r=e?"HEAD":"GET";let n=!1;const s=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!n?"":('"'===t&&(n=!n),t)).join("");return this.url.searchParams.set("select",s),i&&(this.headers.Prefer=`count=${i}`),new vt.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t,{count:e,defaultToNull:i=!0}={}){const r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),e&&r.push(`count=${e}`),i||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);this.url.searchParams.set("columns",t.join(","))}}return new vt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t,{onConflict:e,ignoreDuplicates:i=!1,count:r,defaultToNull:n=!0}={}){const s=[`resolution=${i?"ignore":"merge"}-duplicates`];if(void 0!==e&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&s.push(this.headers.Prefer),r&&s.push(`count=${r}`),n||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);this.url.searchParams.set("columns",t.join(","))}}return new vt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t,{count:e}={}){const i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),e&&i.push(`count=${e}`),this.headers.Prefer=i.join(","),new vt.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete({count:t}={}){const e=[];return t&&e.push(`count=${t}`),this.headers.Prefer&&e.unshift(this.headers.Prefer),this.headers.Prefer=e.join(","),new vt.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var yt={},pt={};Object.defineProperty(pt,"o",{value:!0}),pt.version=void 0,pt.version="0.0.0-automated",Object.defineProperty(yt,"o",{value:!0}),yt.DEFAULT_HEADERS=void 0;const wt=pt;yt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${wt.version}`};var bt=N&&N.l||(t=>t&&t.o?t:{default:t});Object.defineProperty(M,"o",{value:!0});const gt=bt(G),mt=bt(q),_t=yt;M.default=class t{constructor(t,{headers:e={},schema:i,fetch:r}={}){this.url=t,this.headers=Object.assign(Object.assign({},_t.DEFAULT_HEADERS),e),this.schemaName=i,this.fetch=r}from(t){const e=new URL(`${this.url}/${t}`);return new gt.default(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new t(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(t,e={},{head:i=!1,get:r=!1,count:n}={}){let s;const o=new URL(`${this.url}/rpc/${t}`);let l;i||r?(s=i?"HEAD":"GET",Object.entries(e).filter(([t,e])=>void 0!==e).map(([t,e])=>[t,Array.isArray(e)?`{${e.join(",")}}`:`${e}`]).forEach(([t,e])=>{o.searchParams.append(t,e)})):(s="POST",l=e);const h=Object.assign({},this.headers);return n&&(h.Prefer=`count=${n}`),new mt.default({method:s,url:o,headers:h,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};var $t=N&&N.l||(t=>t&&t.o?t:{default:t});Object.defineProperty(W,"o",{value:!0}),W.PostgrestError=W.PostgrestBuilder=W.PostgrestTransformBuilder=W.PostgrestFilterBuilder=W.PostgrestQueryBuilder=W.PostgrestClient=void 0;const jt=$t(M);W.PostgrestClient=jt.default;const kt=$t(G);W.PostgrestQueryBuilder=kt.default;const Ot=$t(q);W.PostgrestFilterBuilder=Ot.default;const St=$t(z);W.PostgrestTransformBuilder=St.default;const Tt=$t(H);W.PostgrestBuilder=Tt.default;const Et=$t(it);W.PostgrestError=Et.default;var xt=W.default={PostgrestClient:jt.default,PostgrestQueryBuilder:kt.default,PostgrestFilterBuilder:Ot.default,PostgrestTransformBuilder:St.default,PostgrestBuilder:Tt.default,PostgrestError:Et.default};const{PostgrestClient:At,PostgrestQueryBuilder:It,PostgrestFilterBuilder:Pt,PostgrestTransformBuilder:Rt,PostgrestBuilder:Ut,PostgrestError:Nt}=xt;class Ct{static detectEnvironment(){var t;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(t=navigator.userAgent)||void 0===t?void 0:t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return 22>t?{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}:void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let e=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(e+=`\n\nSuggested solution: ${t.workaround}`),new Error(e)}static createWebSocket(t,e){return new(this.getWebSocketConstructor())(t,e)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return"native"===t.type||"ws"===t.type}catch(t){return!1}}}var Dt,Lt,Bt,Ft,Jt,Wt,Mt,Gt,qt,zt,Ht;(Lt=Dt||(Dt={}))[Lt.connecting=0]="connecting",Lt[Lt.open=1]="open",Lt[Lt.closing=2]="closing",Lt[Lt.closed=3]="closed",(Ft=Bt||(Bt={})).closed="closed",Ft.errored="errored",Ft.joined="joined",Ft.joining="joining",Ft.leaving="leaving",(Wt=Jt||(Jt={})).close="phx_close",Wt.error="phx_error",Wt.join="phx_join",Wt.reply="phx_reply",Wt.leave="phx_leave",Wt.access_token="access_token",(Mt||(Mt={})).websocket="websocket",(qt=Gt||(Gt={})).Connecting="connecting",qt.Open="open",qt.Closing="closing",qt.Closed="closed";class Vt{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this.h(t)):e("string"==typeof t?JSON.parse(t):{})}h(t){const e=new DataView(t),i=new TextDecoder;return this.u(t,e,i)}u(t,e,i){const r=e.getUint8(1),n=e.getUint8(2);let s=this.HEADER_LENGTH+2;const o=i.decode(t.slice(s,s+r));s+=r;const l=i.decode(t.slice(s,s+n));return s+=n,{ref:null,topic:o,event:l,payload:JSON.parse(i.decode(t.slice(s,t.byteLength)))}}}class Kt{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(Ht=zt||(zt={})).abstime="abstime",Ht.bool="bool",Ht.date="date",Ht.daterange="daterange",Ht.float4="float4",Ht.float8="float8",Ht.int2="int2",Ht.int4="int4",Ht.int4range="int4range",Ht.int8="int8",Ht.int8range="int8range",Ht.json="json",Ht.jsonb="jsonb",Ht.money="money",Ht.numeric="numeric",Ht.oid="oid",Ht.reltime="reltime",Ht.text="text",Ht.time="time",Ht.timestamp="timestamp",Ht.timestamptz="timestamptz",Ht.timetz="timetz",Ht.tsrange="tsrange",Ht.tstzrange="tstzrange";const Yt=(t,e,i={})=>{var r;const n=null!==(r=i.skipTypes)&&void 0!==r?r:[];return Object.keys(e).reduce((i,r)=>(i[r]=Xt(r,t,e,n),i),{})},Xt=(t,e,i,r)=>{const n=e.find(e=>e.name===t),s=null==n?void 0:n.type,o=i[t];return s&&!r.includes(s)?Qt(s,o):Zt(o)},Qt=(t,e)=>{if("_"===t.charAt(0)){const i=t.slice(1,t.length);return re(e,i)}switch(t){case zt.bool:return te(e);case zt.float4:case zt.float8:case zt.int2:case zt.int4:case zt.int8:case zt.numeric:case zt.oid:return ee(e);case zt.json:case zt.jsonb:return ie(e);case zt.timestamp:return ne(e);case zt.abstime:case zt.date:case zt.daterange:case zt.int4range:case zt.int8range:case zt.money:case zt.reltime:case zt.text:case zt.time:case zt.timestamptz:case zt.timetz:case zt.tsrange:case zt.tstzrange:default:return Zt(e)}},Zt=t=>t,te=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},ee=t=>{if("string"==typeof t){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},ie=t=>{if("string"==typeof t)try{return JSON.parse(t)}catch(e){return t}return t},re=(t,e)=>{if("string"!=typeof t)return t;const i=t.length-1,r=t[i];if("{"===t[0]&&"}"===r){let r;const s=t.slice(1,i);try{r=JSON.parse("["+s+"]")}catch(n){r=s?s.split(","):[]}return r.map(t=>Qt(e,t))}return t},ne=t=>"string"==typeof t?t.replace(" ","T"):t,se=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class oe{constructor(t,e,i={},r=1e4){this.channel=t,this.event=e,this.payload=i,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this.v(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this.p("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel.m()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var i;return this.p(t)&&e(null===(i=this.receivedResp)||void 0===i?void 0:i.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._(),this.refEvent=this.channel.$(this.ref),this.channel.j(this.refEvent,{},t=>{this.v(),this.k(),this.receivedResp=t,this.O(t)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(t,e){this.refEvent&&this.channel.S(this.refEvent,{status:t,response:e})}destroy(){this.v(),this.k()}v(){this.refEvent&&this.channel.T(this.refEvent,{})}k(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}O({status:t,response:e}){this.recHooks.filter(e=>e.status===t).forEach(t=>t.callback(e))}p(t){return this.receivedResp&&this.receivedResp.status===t}}var le,he,ue,ae,ce,de,fe,ve;(he=le||(le={})).SYNC="sync",he.JOIN="join",he.LEAVE="leave";class ye{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin(){},onLeave(){},onSync(){}};const i=(null==e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel.j(i.state,{},t=>{const{onJoin:e,onLeave:i,onSync:r}=this.caller;this.joinRef=this.channel.m(),this.state=ye.syncState(this.state,t,e,i),this.pendingDiffs.forEach(t=>{this.state=ye.syncDiff(this.state,t,e,i)}),this.pendingDiffs=[],r()}),this.channel.j(i.diff,{},t=>{const{onJoin:e,onLeave:i,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(t):(this.state=ye.syncDiff(this.state,t,e,i),r())}),this.onJoin((t,e,i)=>{this.channel.S("presence",{event:"join",key:t,currentPresences:e,newPresences:i})}),this.onLeave((t,e,i)=>{this.channel.S("presence",{event:"leave",key:t,currentPresences:e,leftPresences:i})}),this.onSync(()=>{this.channel.S("presence",{event:"sync"})})}static syncState(t,e,i,r){const n=this.cloneDeep(t),s=this.transformState(e),o={},l={};return this.map(n,(t,e)=>{s[t]||(l[t]=e)}),this.map(s,(t,e)=>{const i=n[t];if(i){const r=e.map(t=>t.presence_ref),n=i.map(t=>t.presence_ref),s=e.filter(t=>0>n.indexOf(t.presence_ref)),h=i.filter(t=>0>r.indexOf(t.presence_ref));s.length>0&&(o[t]=s),h.length>0&&(l[t]=h)}else o[t]=e}),this.syncDiff(n,{joins:o,leaves:l},i,r)}static syncDiff(t,e,i,r){const{joins:n,leaves:s}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return i||(i=()=>{}),r||(r=()=>{}),this.map(n,(e,r)=>{var n;const s=null!==(n=t[e])&&void 0!==n?n:[];if(t[e]=this.cloneDeep(r),s.length>0){const i=t[e].map(t=>t.presence_ref),r=s.filter(t=>0>i.indexOf(t.presence_ref));t[e].unshift(...r)}i(e,s,r)}),this.map(s,(e,i)=>{let n=t[e];if(!n)return;const s=i.map(t=>t.presence_ref);n=n.filter(t=>0>s.indexOf(t.presence_ref)),t[e]=n,r(e,n,i),0===n.length&&delete t[e]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(i=>e(i,t[i]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,i)=>{const r=t[i];return e[i]="metas"in r?r.metas.map(t=>(t.presence_ref=t.phx_ref,delete t.phx_ref,delete t.phx_ref_prev,t)):r,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel.m()}}(ae=ue||(ue={})).ALL="*",ae.INSERT="INSERT",ae.UPDATE="UPDATE",ae.DELETE="DELETE",(de=ce||(ce={})).BROADCAST="broadcast",de.PRESENCE="presence",de.POSTGRES_CHANGES="postgres_changes",de.SYSTEM="system",(ve=fe||(fe={})).SUBSCRIBED="SUBSCRIBED",ve.TIMED_OUT="TIMED_OUT",ve.CLOSED="CLOSED",ve.CHANNEL_ERROR="CHANNEL_ERROR";class pe{constructor(t,e={config:{}},i){this.topic=t,this.params=e,this.socket=i,this.bindings={},this.state=Bt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new oe(this,Jt.join,this.params,this.timeout),this.rejoinTimer=new Kt(()=>this.A(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Bt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(t=>t.send()),this.pushBuffer=[]}),this.I(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.m()}`),this.state=Bt.closed,this.socket.P(this)}),this.R(t=>{this.U()||this.N()||(this.socket.log("channel",`error ${this.topic}`,t),this.state=Bt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this.C()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Bt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",t=>{this.U()||this.N()||(this.socket.log("channel",`error ${this.topic}`,t),this.state=Bt.errored,this.rejoinTimer.scheduleTimeout())}),this.j(Jt.reply,{},(t,e)=>{this.S(this.$(e),t)}),this.presence=new ye(this),this.broadcastEndpointURL=se(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(t,e=this.timeout){var i,r;if(this.socket.isConnected()||this.socket.connect(),this.state==Bt.closed){const{config:{broadcast:n,presence:s,private:o}}=this.params,l=null!==(r=null===(i=this.bindings.postgres_changes)||void 0===i?void 0:i.map(t=>t.filter))&&void 0!==r?r:[],h=!!this.bindings[ce.PRESENCE]&&this.bindings[ce.PRESENCE].length>0,u={},a={broadcast:n,presence:Object.assign(Object.assign({},s),{enabled:h}),postgres_changes:l,private:o};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this.R(e=>null==t?void 0:t(fe.CHANNEL_ERROR,e)),this.I(()=>null==t?void 0:t(fe.CLOSED)),this.updateJoinPayload(Object.assign({config:a},u)),this.joinedOnce=!0,this.D(e),this.joinPush.receive("ok",e=>R(this,[e],function*({postgres_changes:e}){var i;if(this.socket.setAuth(),void 0!==e){const r=this.bindings.postgres_changes,n=null!==(i=null==r?void 0:r.length)&&void 0!==i?i:0,s=[];for(let i=0;n>i;i++){const n=r[i],{filter:{event:o,schema:l,table:h,filter:u}}=n,a=e&&e[i];if(!a||a.event!==o||a.schema!==l||a.table!==h||a.filter!==u)return this.unsubscribe(),this.state=Bt.errored,void(null==t||t(fe.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));s.push(Object.assign(Object.assign({},n),{id:a.id}))}return this.bindings.postgres_changes=s,void(t&&t(fe.SUBSCRIBED))}null==t||t(fe.SUBSCRIBED)})).receive("error",e=>{this.state=Bt.errored,null==t||t(fe.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(e).join(", ")||"error")))}).receive("timeout",()=>{null==t||t(fe.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(t){return R(this,arguments,function*(t,e={}){return yield this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)})}untrack(){return R(this,arguments,function*(t={}){return yield this.send({type:"presence",event:"untrack"},t)})}on(t,e,i){return this.state===Bt.joined&&t===ce.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this.j(t,e,i)}send(t){return R(this,arguments,function*(t,e={}){var i,r;if(this.L()||"broadcast"!==t.type)return new Promise(i=>{var r,n,s;const o=this.B(t.type,t,e.timeout||this.timeout);"broadcast"!==t.type||(null===(s=null===(n=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===n?void 0:n.broadcast)||void 0===s?void 0:s.ack)||i("ok"),o.receive("ok",()=>i("ok")),o.receive("error",()=>i("error")),o.receive("timeout",()=>i("timed out"))});{const{event:s,payload:o}=t,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:o,private:this.private}]})};try{const t=yield this.F(this.broadcastEndpointURL,l,null!==(i=e.timeout)&&void 0!==i?i:this.timeout);return yield null===(r=t.body)||void 0===r?void 0:r.cancel(),t.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Bt.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this.S(Jt.close,"leave",this.m())};this.joinPush.destroy();let i=null;return new Promise(r=>{i=new oe(this,Jt.leave,{},t),i.receive("ok",()=>{e(),r("ok")}).receive("timeout",()=>{e(),r("timed out")}).receive("error",()=>{r("error")}),i.send(),this.L()||i.trigger("ok",{})}).finally(()=>{null==i||i.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Bt.closed,this.bindings={}}F(t,e,i){return R(this,null,function*(){const r=new AbortController,n=setTimeout(()=>r.abort(),i),s=yield this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:r.signal}));return clearTimeout(n),s})}B(t,e,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new oe(this,t,e,i);return this.L()?r.send():this.J(r),r}J(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>100){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}W(t,e,i){return e}M(t){return this.topic===t}m(){return this.joinPush.ref}S(t,e,i){var r,n;const s=t.toLocaleLowerCase(),{close:o,error:l,leave:h,join:u}=Jt;if(i&&[o,l,h,u].indexOf(s)>=0&&i!==this.m())return;let a=this.W(s,e,i);if(e&&!a)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(t=>{var e,i,r;return"*"===(null===(e=t.filter)||void 0===e?void 0:e.event)||(null===(r=null===(i=t.filter)||void 0===i?void 0:i.event)||void 0===r?void 0:r.toLocaleLowerCase())===s}).map(t=>t.callback(a,i)):null===(n=this.bindings[s])||void 0===n||n.filter(t=>{var i,r,n,o,l,h;if(["broadcast","presence","postgres_changes"].includes(s)){if("id"in t){const s=t.id,o=null===(i=t.filter)||void 0===i?void 0:i.event;return s&&(null===(r=e.ids)||void 0===r?void 0:r.includes(s))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(n=e.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const i=null===(l=null===(o=null==t?void 0:t.filter)||void 0===o?void 0:o.event)||void 0===l?void 0:l.toLocaleLowerCase();return"*"===i||i===(null===(h=null==e?void 0:e.event)||void 0===h?void 0:h.toLocaleLowerCase())}}return t.type.toLocaleLowerCase()===s}).map(t=>{if("object"==typeof a&&"ids"in a){const t=a.data,{schema:e,table:i,commit_timestamp:r,type:n,errors:s}=t,o={schema:e,table:i,commit_timestamp:r,eventType:n,new:{},old:{},errors:s};a=Object.assign(Object.assign({},o),this.G(t))}t.callback(a,i)})}N(){return this.state===Bt.closed}q(){return this.state===Bt.joined}C(){return this.state===Bt.joining}U(){return this.state===Bt.leaving}$(t){return`chan_reply_${t}`}j(t,e,i){const r=t.toLocaleLowerCase(),n={type:r,filter:e,callback:i};return this.bindings[r]?this.bindings[r].push(n):this.bindings[r]=[n],this}T(t,e){const i=t.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(t=>{var r;return!((null===(r=t.type)||void 0===r?void 0:r.toLocaleLowerCase())===i&&pe.isEqual(t.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(t[i]!==e[i])return!1;return!0}A(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.D()}I(t){this.j(Jt.close,{},t)}R(t){this.j(Jt.error,{},e=>t(e))}L(){return this.socket.isConnected()&&this.q()}D(t=this.timeout){this.U()||(this.socket.H(this.topic),this.state=Bt.joining,this.joinPush.resend(t))}G(t){const e={new:{},old:{}};return"INSERT"!==t.type&&"UPDATE"!==t.type||(e.new=Yt(t.columns,t.record)),"UPDATE"!==t.type&&"DELETE"!==t.type||(e.old=Yt(t.columns,t.old_record)),e}}const we=()=>{},be=[1e3,2e3,5e3,1e4];class ge{constructor(t,e){var i;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=we,this.ref=0,this.reconnectTimer=null,this.logger=we,this.conn=null,this.sendBuffer=[],this.serializer=new Vt,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this.V="disconnected",this.K=!1,this.Y=null,this.X=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>C(()=>R(this,null,function*(){const{default:t}=yield Promise.resolve().then(()=>tt);return{default:t}}),void 0).then(({default:e})=>e(...t)).catch(t=>{throw new Error(`Failed to load @supabase/node-fetch: ${t.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...t)=>e(...t)},!(null===(i=null==e?void 0:e.params)||void 0===i?void 0:i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=e.params.apikey,this.endPoint=`${t}/${Mt.websocket}`,this.httpEndpoint=se(t),this.Z(e),this.tt(),this.fetch=this.X(null==e?void 0:e.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this.et("connecting"),this.it("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Ct.createWebSocket(this.endpointURL())}catch(t){this.et("disconnected");const e=t.message;if(e.includes("Node.js"))throw new Error(`${e}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${e}`)}this.rt()}}endpointURL(){return this.nt(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(t,e){if(!this.isDisconnecting())if(this.et("disconnecting",!0),this.conn){const i=setTimeout(()=>{this.et("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this.et("disconnected")},t?this.conn.close(t,null!=e?e:""):this.conn.close(),this.st()}else this.et("disconnected")}getChannels(){return this.channels}removeChannel(t){return R(this,null,function*(){const e=yield t.unsubscribe();return 0===this.channels.length&&this.disconnect(),e})}removeAllChannels(){return R(this,null,function*(){const t=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),t})}log(t,e,i){this.logger(t,e,i)}connectionState(){switch(this.conn&&this.conn.readyState){case Dt.connecting:return Gt.Connecting;case Dt.open:return Gt.Open;case Dt.closing:return Gt.Closing;default:return Gt.Closed}}isConnected(){return this.connectionState()===Gt.Open}isConnecting(){return"connecting"===this.V}isDisconnecting(){return"disconnecting"===this.V}channel(t,e={config:{}}){const i=`realtime:${t}`,r=this.getChannels().find(t=>t.topic===i);if(r)return r;{const i=new pe(`realtime:${t}`,e,this);return this.channels.push(i),i}}push(t){const{topic:e,event:i,payload:r,ref:n}=t,s=()=>{this.encode(t,t=>{var e;null===(e=this.conn)||void 0===e||e.send(t)})};this.log("push",`${e} ${i} (${n})`,r),this.isConnected()?s():this.sendBuffer.push(s)}setAuth(t=null){return R(this,null,function*(){this.Y=this.ot(t);try{yield this.Y}finally{this.Y=null}})}sendHeartbeat(){return R(this,null,function*(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this.K=!1,null===(t=this.conn)||void 0===t||t.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var t;this.isConnected()||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout()},100);this.pendingHeartbeatRef=this._(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this.it("heartbeat")}else this.heartbeatCallback("disconnected")})}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}H(t){let e=this.channels.find(e=>e.topic===t&&(e.q()||e.C()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}P(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}ht(t){this.decode(t.data,t=>{"phoenix"===t.topic&&"phx_reply"===t.event&&this.heartbeatCallback("ok"===t.payload.status?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:e,event:i,payload:r,ref:n}=t,s=n?`(${n})`:"",o=r.status||"";this.log("receive",`${o} ${e} ${i} ${s}`.trim(),r),this.channels.filter(t=>t.M(e)).forEach(t=>t.S(i,r,n)),this.ut("message",t)})}ct(t){var e;"heartbeat"===t&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===t&&(null===(e=this.reconnectTimer)||void 0===e||e.reset())}dt(){this.ct("heartbeat"),this.ct("reconnect")}rt(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this.ft(),this.conn.onerror=t=>this.vt(t),this.conn.onmessage=t=>this.ht(t),this.conn.onclose=t=>this.yt(t))}st(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this.dt(),this.channels.forEach(t=>t.teardown())}ft(){this.et("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.ct("reconnect"),this.worker?this.workerRef||this.wt():this.bt(),this.ut("open")}bt(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}wt(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._t(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{"keepAlive"===t.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}yt(t){var e;this.et("disconnected"),this.log("transport","close",t),this.$t(),this.ct("heartbeat"),this.K||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout(),this.ut("close",t)}vt(t){this.et("disconnected"),this.log("transport",`${t}`),this.$t(),this.ut("error",t)}$t(){this.channels.forEach(t=>t.S(Jt.error))}nt(t,e){if(0===Object.keys(e).length)return t;const i=t.match(/\?/)?"&":"?";return`${t}${i}${new URLSearchParams(e)}`}_t(t){let e;if(t)e=t;else{const t=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});e=URL.createObjectURL(t)}return e}et(t,e=!1){this.V=t,"connecting"===t?this.K=!1:"disconnecting"===t&&(this.K=e)}ot(t=null){return R(this,null,function*(){let e;e=t||(this.accessToken?yield this.accessToken():this.accessTokenValue),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const i={access_token:e,version:"realtime-js/2.15.1"};e&&t.updateJoinPayload(i),t.joinedOnce&&t.q()&&t.B(Jt.access_token,{access_token:e})}))})}jt(){return R(this,null,function*(){this.Y&&(yield this.Y)})}it(t="general"){this.setAuth().catch(e=>{this.log("error",`error setting auth in ${t}`,e)})}ut(t,e){try{this.stateChangeCallbacks[t].forEach(i=>{try{i(e)}catch(r){this.log("error",`error in ${t} callback`,r)}})}catch(i){this.log("error",`error triggering ${t} callbacks`,i)}}tt(){this.reconnectTimer=new Kt(()=>R(this,null,function*(){setTimeout(()=>R(this,null,function*(){yield this.jt(),this.isConnected()||this.connect()}),10)}),this.reconnectAfterMs)}Z(t){var e,i,r,n,s,o,l,h;if(this.transport=null!==(e=null==t?void 0:t.transport)&&void 0!==e?e:null,this.timeout=null!==(i=null==t?void 0:t.timeout)&&void 0!==i?i:1e4,this.heartbeatIntervalMs=null!==(r=null==t?void 0:t.heartbeatIntervalMs)&&void 0!==r?r:25e3,this.worker=null!==(n=null==t?void 0:t.worker)&&void 0!==n&&n,this.accessToken=null!==(s=null==t?void 0:t.accessToken)&&void 0!==s?s:null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.logger)&&(this.logger=t.logger),((null==t?void 0:t.logLevel)||(null==t?void 0:t.log_level))&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(o=null==t?void 0:t.reconnectAfterMs)&&void 0!==o?o:t=>be[t-1]||1e4,this.encode=null!==(l=null==t?void 0:t.encode)&&void 0!==l?l:(t,e)=>e(JSON.stringify(t)),this.decode=null!==(h=null==t?void 0:t.decode)&&void 0!==h?h:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==t?void 0:t.workerUrl}}}class me extends Error{constructor(t){super(t),this.t=!0,this.name="StorageError"}}class _e extends me{constructor(t,e,i){super(t),this.name="StorageApiError",this.status=e,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class $e extends me{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}}const je=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>C(()=>R(void 0,null,function*(){const{default:t}=yield Promise.resolve().then(()=>tt);return{default:t}}),void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},ke=t=>{if(Array.isArray(t))return t.map(t=>ke(t));if("function"==typeof t||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([t,i])=>{const r=t.replace(/([-_][a-z])/gi,t=>t.toUpperCase().replace(/[-_]/g,""));e[r]=ke(i)}),e};var Oe=(t,e,i,r)=>new(i||(i=Promise))((n,s)=>{function o(t){try{h(r.next(t))}catch(e){s(e)}}function l(t){try{h(r.throw(t))}catch(e){s(e)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(t=>{t(e)})).then(o,l)}h((r=r.apply(t,e||[])).next())});const Se=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t);var Te=(t,e,i,r)=>new(i||(i=Promise))((n,s)=>{function o(t){try{h(r.next(t))}catch(e){s(e)}}function l(t){try{h(r.throw(t))}catch(e){s(e)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(t=>{t(e)})).then(o,l)}h((r=r.apply(t,e||[])).next())});const Ee={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},xe={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ae{constructor(t,e={},i,r){this.url=t,this.headers=e,this.bucketId=i,this.fetch=je(r)}uploadOrUpdate(e,i,s,o){return Te(this,void 0,void 0,function*(){try{let t;const l=Object.assign(Object.assign({},xe),o);let h=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(l.upsert)});const u=l.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(t=new FormData,t.append("cacheControl",l.cacheControl),u&&t.append("metadata",this.encodeMetadata(u)),t.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(t=s,t.append("cacheControl",l.cacheControl),u&&t.append("metadata",this.encodeMetadata(u))):(t=s,h["cache-control"]=`max-age=${l.cacheControl}`,h["content-type"]=l.contentType,u&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(u)))),(null==o?void 0:o.headers)&&(h=Object.assign(Object.assign({},h),o.headers));const a=this.kt(i),c=this.Ot(a),d=yield("PUT"==e?n:r)(this.fetch,`${this.url}/object/${c}`,t,Object.assign({headers:h},(null==l?void 0:l.duplex)?{duplex:l.duplex}:{}));return{data:{path:a,id:d.Id,fullPath:d.Key},error:null}}catch(l){if(t(l))return{data:null,error:l};throw l}})}upload(t,e,i){return Te(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,i)})}uploadToSignedUrl(e,i,r,s){return Te(this,void 0,void 0,function*(){const o=this.kt(e),l=this.Ot(o),h=new URL(this.url+`/object/upload/sign/${l}`);h.searchParams.set("token",i);try{let t;const e=Object.assign({upsert:xe.upsert},s),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(e.upsert)});return"undefined"!=typeof Blob&&r instanceof Blob?(t=new FormData,t.append("cacheControl",e.cacheControl),t.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(t=r,t.append("cacheControl",e.cacheControl)):(t=r,i["cache-control"]=`max-age=${e.cacheControl}`,i["content-type"]=e.contentType),{data:{path:o,fullPath:(yield n(this.fetch,h.toString(),t,{headers:i})).Key},error:null}}catch(u){if(t(u))return{data:null,error:u};throw u}})}createSignedUploadUrl(e,i){return Te(this,void 0,void 0,function*(){try{let t=this.Ot(e);const n=Object.assign({},this.headers);(null==i?void 0:i.upsert)&&(n["x-upsert"]="true");const s=yield r(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:n}),o=new URL(this.url+s.url),l=o.searchParams.get("token");if(!l)throw new me("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}update(t,e,i){return Te(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,i)})}move(e,i,n){return Te(this,void 0,void 0,function*(){try{return{data:yield r(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i,destinationBucket:null==n?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(t(s))return{data:null,error:s};throw s}})}copy(e,i,n){return Te(this,void 0,void 0,function*(){try{return{data:{path:(yield r(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i,destinationBucket:null==n?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(t(s))return{data:null,error:s};throw s}})}createSignedUrl(e,i,n){return Te(this,void 0,void 0,function*(){try{let t=this.Ot(e),s=yield r(this.fetch,`${this.url}/object/sign/${t}`,Object.assign({expiresIn:i},(null==n?void 0:n.transform)?{transform:n.transform}:{}),{headers:this.headers});const o=(null==n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(s){if(t(s))return{data:null,error:s};throw s}})}createSignedUrls(e,i,n){return Te(this,void 0,void 0,function*(){try{const t=yield r(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:i,paths:e},{headers:this.headers}),s=(null==n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return{data:t.map(t=>Object.assign(Object.assign({},t),{signedUrl:t.signedURL?encodeURI(`${this.url}${t.signedURL}${s}`):null})),error:null}}catch(s){if(t(s))return{data:null,error:s};throw s}})}download(e,r){return Te(this,void 0,void 0,function*(){const n=void 0!==(null==r?void 0:r.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==r?void 0:r.transform)||{}),o=s?`?${s}`:"";try{const t=this.Ot(e),r=yield i(this.fetch,`${this.url}/${n}/${t}${o}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(l){if(t(l))return{data:null,error:l};throw l}})}info(e){return Te(this,void 0,void 0,function*(){const r=this.Ot(e);try{const t=yield i(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:ke(t),error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}exists(i){return Te(this,void 0,void 0,function*(){const r=this.Ot(i);try{return yield function(t,i,r){return Oe(this,void 0,void 0,function*(){return e(t,"HEAD",i,Object.assign(Object.assign({},r),{noResolveJson:!0}),void 0)})}(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(t(n)&&n instanceof $e){const t=n.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,e){const i=this.Ot(t),r=[],n=(null==e?void 0:e.download)?`download=${!0===e.download?"":e.download}`:"";""!==n&&r.push(n);const s=void 0!==(null==e?void 0:e.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==e?void 0:e.transform)||{});""!==o&&r.push(o);let l=r.join("&");return""!==l&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${s}/public/${i}${l}`)}}}remove(e){return Te(this,void 0,void 0,function*(){try{return{data:yield s(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(i){if(t(i))return{data:null,error:i};throw i}})}list(e,i,n){return Te(this,void 0,void 0,function*(){try{const t=Object.assign(Object.assign(Object.assign({},Ee),i),{prefix:e||""});return{data:yield r(this.fetch,`${this.url}/object/list/${this.bucketId}`,t,{headers:this.headers},n),error:null}}catch(s){if(t(s))return{data:null,error:s};throw s}})}listV2(e,i){return Te(this,void 0,void 0,function*(){try{const t=Object.assign({},e);return{data:yield r(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,t,{headers:this.headers},i),error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return"undefined"!=typeof Buffer?Buffer.from(t).toString("base64"):btoa(t)}Ot(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}kt(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}}const Ie={"X-Client-Info":"storage-js/2.11.0"};var Pe=(t,e,i,r)=>new(i||(i=Promise))((n,s)=>{function o(t){try{h(r.next(t))}catch(e){s(e)}}function l(t){try{h(r.throw(t))}catch(e){s(e)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(t=>{t(e)})).then(o,l)}h((r=r.apply(t,e||[])).next())});class Re{constructor(t,e={},i,r){const n=new URL(t);(null==r?void 0:r.useNewHostname)&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase.")),this.url=n.href,this.headers=Object.assign(Object.assign({},Ie),e),this.fetch=je(i)}listBuckets(){return Pe(this,void 0,void 0,function*(){try{return{data:yield i(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(t(e))return{data:null,error:e};throw e}})}getBucket(e){return Pe(this,void 0,void 0,function*(){try{return{data:yield i(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(r){if(t(r))return{data:null,error:r};throw r}})}createBucket(e,i={public:!1}){return Pe(this,void 0,void 0,function*(){try{return{data:yield r(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:i.type,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}updateBucket(e,i){return Pe(this,void 0,void 0,function*(){try{return{data:yield n(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(t(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Pe(this,void 0,void 0,function*(){try{return{data:yield r(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(i){if(t(i))return{data:null,error:i};throw i}})}deleteBucket(e){return Pe(this,void 0,void 0,function*(){try{return{data:yield s(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(i){if(t(i))return{data:null,error:i};throw i}})}}class Ue extends Re{constructor(t,e={},i,r){super(t,e,i,r)}from(t){return new Ae(this.url,this.headers,t,this.fetch)}}let Ne="";Ne="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Ce={headers:{"X-Client-Info":`supabase-js-${Ne}/2.55.0`}},De={schema:"public"},Le={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Be={},Fe="2.71.1",Je=3e4,We={"X-Client-Info":`gotrue-js/${Fe}`},Me="X-Supabase-Api-Version",Ge={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},qe=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class ze extends Error{constructor(t,e,i){super(t),this.i=!0,this.name="AuthError",this.status=e,this.code=i}}class He extends ze{constructor(t,e,i){super(t,e,i),this.name="AuthApiError",this.status=e,this.code=i}}class Ve extends ze{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class Ke extends ze{constructor(t,e,i,r){super(t,i,r),this.name=e,this.status=i}}class Ye extends Ke{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Xe extends Ke{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Qe extends Ke{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Ze extends Ke{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ti extends Ke{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ei extends Ke{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}class ii extends Ke{constructor(t,e,i){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=i}}class ri extends Ke{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const ni="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),si=" \t\n\r=".split(""),oi=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<si.length;e+=1)t[si[e].charCodeAt(0)]=-2;for(let e=0;e<ni.length;e+=1)t[ni[e].charCodeAt(0)]=e;return t})(),li=()=>"undefined"!=typeof window&&"undefined"!=typeof document,hi={tested:!1,writable:!1},ui=()=>{if(!li())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(hi.tested)return hi.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),hi.tested=!0,hi.writable=!0}catch(e){hi.tested=!0,hi.writable=!1}return hi.writable},ai=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>C(()=>R(void 0,null,function*(){const{default:t}=yield Promise.resolve().then(()=>tt);return{default:t}}),void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},ci=(t,e,i)=>R(void 0,null,function*(){yield t.setItem(e,JSON.stringify(i))}),di=(t,e)=>R(void 0,null,function*(){const i=yield t.getItem(e);if(!i)return null;try{return JSON.parse(i)}catch(r){return i}}),fi=(t,e)=>R(void 0,null,function*(){yield t.removeItem(e)});class vi{constructor(){this.promise=new vi.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}vi.promiseConstructor=Promise;const yi=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,pi=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/,wi=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),bi=[502,503,504],gi=["global","local","others"];class mi{constructor({url:t="",headers:e={},fetch:i}){this.url=t,this.headers=e,this.fetch=ai(i),this.mfa={listFactors:this.St.bind(this),deleteFactor:this.Tt.bind(this)}}signOut(t){return R(this,arguments,function*(t,e=gi[0]){if(0>gi.indexOf(e))throw new Error(`@supabase/auth-js: Parameter scope must be one of ${gi.join(", ")}`);try{return yield _(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(i){if(o(i))return{data:null,error:i};throw i}})}inviteUserByEmail(t){return R(this,arguments,function*(t,e={}){try{return yield _(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:k})}catch(i){if(o(i))return{data:{user:null},error:i};throw i}})}generateLink(t){return R(this,null,function*(){try{const{options:e}=t,i=((t,e)=>{var i={};for(var r in t)({}).hasOwnProperty.call(t,r)&&0>e.indexOf(r)&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(t);n<r.length;n++)0>e.indexOf(r[n])&&{}.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]])}return i})(t,["options"]),r=Object.assign(Object.assign({},i),e);return"newEmail"in i&&(r.new_email=null==i?void 0:i.newEmail,delete r.newEmail),yield _(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:S,redirectTo:null==e?void 0:e.redirectTo})}catch(e){if(o(e))return{data:{properties:null,user:null},error:e};throw e}})}createUser(t){return R(this,null,function*(){try{return yield _(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:k})}catch(e){if(o(e))return{data:{user:null},error:e};throw e}})}listUsers(t){return R(this,null,function*(){var e,i,r,n,s,l,h;try{const o={nextPage:null,lastPage:0,total:0},u=yield _(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(i=null===(e=null==t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==i?i:"",per_page:null!==(n=null===(r=null==t?void 0:t.perPage)||void 0===r?void 0:r.toString())&&void 0!==n?n:""},xform:T});if(u.error)throw u.error;const a=yield u.json(),c=null!==(s=u.headers.get("x-total-count"))&&void 0!==s?s:0,d=null!==(h=null===(l=u.headers.get("link"))||void 0===l?void 0:l.split(","))&&void 0!==h?h:[];return d.length>0&&(d.forEach(t=>{const e=parseInt(t.split(";")[0].split("=")[1].substring(0,1)),i=JSON.parse(t.split(";")[1].split("=")[1]);o[`${i}Page`]=e}),o.total=parseInt(c)),{data:Object.assign(Object.assign({},a),o),error:null}}catch(u){if(o(u))return{data:{users:[]},error:u};throw u}})}getUserById(t){return R(this,null,function*(){w(t);try{return yield _(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:k})}catch(e){if(o(e))return{data:{user:null},error:e};throw e}})}updateUserById(t,e){return R(this,null,function*(){w(t);try{return yield _(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:k})}catch(i){if(o(i))return{data:{user:null},error:i};throw i}})}deleteUser(t,e=!1){return R(this,null,function*(){w(t);try{return yield _(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:k})}catch(i){if(o(i))return{data:{user:null},error:i};throw i}})}St(t){return R(this,null,function*(){w(t.userId);try{const{data:e,error:i}=yield _(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform(t){return{data:{factors:t},error:null}}});return{data:e,error:i}}catch(e){if(o(e))return{data:null,error:e};throw e}})}Tt(t){return R(this,null,function*(){w(t.userId),w(t.id);try{return{data:yield _(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(o(e))return{data:null,error:e};throw e}})}}const _i=!!(globalThis&&ui()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class $i extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class ji extends $i{}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"Et",{get(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.Et}catch(t){"undefined"!=typeof self&&(self.globalThis=self)}}();const ki={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:We,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Oi={};class Si{constructor(t){var e,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Si.nextInstanceID,Si.nextInstanceID+=1,this.instanceID>0&&li();const r=Object.assign(Object.assign({},ki),t);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new mi({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=ai(r.fetch),this.lock=r.lock||A,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:li()&&(null===(e=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===e?void 0:e.locks)?this.lock=x:this.lock=A,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this.xt.bind(this),enroll:this.At.bind(this),unenroll:this.It.bind(this),challenge:this.Pt.bind(this),listFactors:this.St.bind(this),challengeAndVerify:this.Rt.bind(this),getAuthenticatorAssuranceLevel:this.Ut.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:ui()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=E(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=E(this.memoryStorage)),li()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){}null===(i=this.broadcastChannel)||void 0===i||i.addEventListener("message",t=>R(this,null,function*(){this.Nt("received broadcast notification from other tab or client",t),yield this.Ct(t.data.event,t.data.session,!1)}))}this.initialize()}get jwks(){var t,e;return null!==(e=null===(t=Oi[this.storageKey])||void 0===t?void 0:t.jwks)&&void 0!==e?e:{keys:[]}}set jwks(t){Oi[this.storageKey]=Object.assign(Object.assign({},Oi[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return null!==(e=null===(t=Oi[this.storageKey])||void 0===t?void 0:t.cachedAt)&&void 0!==e?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Oi[this.storageKey]=Object.assign(Object.assign({},Oi[this.storageKey]),{cachedAt:t})}Nt(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Fe}) ${(new Date).toISOString()}`,...t),this}initialize(){return R(this,null,function*(){return this.initializePromise||(this.initializePromise=(()=>R(this,null,function*(){return yield this.Dt(-1,()=>R(this,null,function*(){return yield this.Lt()}))}))()),yield this.initializePromise})}Lt(){return R(this,null,function*(){var t;try{const e=(t=>{const e={},i=new URL(t);if(i.hash&&"#"===i.hash[0])try{new URLSearchParams(i.hash.substring(1)).forEach((t,i)=>{e[i]=t})}catch(r){}return i.searchParams.forEach((t,i)=>{e[i]=t}),e})(window.location.href);let i="none";if(this.Bt(e)?i="implicit":(yield this.Ft(e))&&(i="pkce"),li()&&this.detectSessionInUrl&&"none"!==i){const{data:r,error:n}=yield this.Jt(e,i);if(n){if(this.Nt("#_initialize()","error detecting session from URL",n),(t=>o(t)&&"AuthImplicitGrantRedirectError"===t.name)(n)){const e=null===(t=n.details)||void 0===t?void 0:t.code;if("identity_already_exists"===e||"identity_not_found"===e||"single_identity_not_deletable"===e)return{error:n}}return yield this.Wt(),{error:n}}const{session:s,redirectType:l}=r;return this.Nt("#_initialize()","detected session in URL",s,"redirect type",l),yield this.Mt(s),setTimeout(()=>R(this,null,function*(){"recovery"===l?yield this.Ct("PASSWORD_RECOVERY",s):yield this.Ct("SIGNED_IN",s)}),0),{error:null}}return yield this.Gt(),{error:null}}catch(e){return o(e)?{error:e}:{error:new Ve("Unexpected error during initialization",e)}}finally{yield this.qt(),this.Nt("#_initialize()","end")}})}signInAnonymously(t){return R(this,null,function*(){var e,i,r;try{const n=yield _(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(i=null===(e=null==t?void 0:t.options)||void 0===e?void 0:e.data)&&void 0!==i?i:{},gotrue_meta_security:{captcha_token:null===(r=null==t?void 0:t.options)||void 0===r?void 0:r.captchaToken}},xform:$}),{data:s,error:o}=n;if(o||!s)return{data:{user:null,session:null},error:o};const l=s.session,h=s.user;return s.session&&(yield this.Mt(s.session),yield this.Ct("SIGNED_IN",l)),{data:{user:h,session:l},error:null}}catch(n){if(o(n))return{data:{user:null,session:null},error:n};throw n}})}signUp(t){return R(this,null,function*(){var e,i,r;try{let n;if("email"in t){const{email:i,password:r,options:s}=t;let o=null,l=null;"pkce"===this.flowType&&([o,l]=yield p(this.storage,this.storageKey)),n=yield _(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==s?void 0:s.emailRedirectTo,body:{email:i,password:r,data:null!==(e=null==s?void 0:s.data)&&void 0!==e?e:{},gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},code_challenge:o,code_challenge_method:l},xform:$})}else{if(!("phone"in t))throw new Qe("You must provide either an email or phone number and a password");{const{phone:e,password:s,options:o}=t;n=yield _(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:e,password:s,data:null!==(i=null==o?void 0:o.data)&&void 0!==i?i:{},channel:null!==(r=null==o?void 0:o.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:$})}}const{data:s,error:o}=n;if(o||!s)return{data:{user:null,session:null},error:o};const l=s.session,h=s.user;return s.session&&(yield this.Mt(s.session),yield this.Ct("SIGNED_IN",l)),{data:{user:h,session:l},error:null}}catch(n){if(o(n))return{data:{user:null,session:null},error:n};throw n}})}signInWithPassword(t){return R(this,null,function*(){try{let e;if("email"in t){const{email:i,password:r,options:n}=t;e=yield _(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:j})}else{if(!("phone"in t))throw new Qe("You must provide either an email or phone number and a password");{const{phone:i,password:r,options:n}=t;e=yield _(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:j})}}const{data:i,error:r}=e;return r?{data:{user:null,session:null},error:r}:i&&i.session&&i.user?(i.session&&(yield this.Mt(i.session),yield this.Ct("SIGNED_IN",i.session)),{data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:r}):{data:{user:null,session:null},error:new Xe}}catch(e){if(o(e))return{data:{user:null,session:null},error:e};throw e}})}signInWithOAuth(t){return R(this,null,function*(){var e,i,r,n;return yield this.zt(t.provider,{redirectTo:null===(e=t.options)||void 0===e?void 0:e.redirectTo,scopes:null===(i=t.options)||void 0===i?void 0:i.scopes,queryParams:null===(r=t.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(n=t.options)||void 0===n?void 0:n.skipBrowserRedirect})})}exchangeCodeForSession(t){return R(this,null,function*(){return yield this.initializePromise,this.Dt(-1,()=>R(this,null,function*(){return this.Ht(t)}))})}signInWithWeb3(t){return R(this,null,function*(){const{chain:e}=t;if("solana"===e)return yield this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${e}"`)})}signInWithSolana(t){return R(this,null,function*(){var e,i,r,n,s,l,h,u,a,c,d,v;let y,p;if("message"in t)y=t.message,p=t.signature;else{const{chain:o,wallet:d,statement:f,options:v}=t;let w;if(li())if("object"==typeof d)w=d;else{const t=window;if(!("solana"in t)||"object"!=typeof t.solana||!("signIn"in t.solana&&"function"==typeof t.solana.signIn||"signMessage"in t.solana&&"function"==typeof t.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");w=t.solana}else{if("object"!=typeof d||!(null==v?void 0:v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=d}const b=new URL(null!==(e=null==v?void 0:v.url)&&void 0!==e?e:window.location.href);if("signIn"in w&&w.signIn){const t=yield w.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==v?void 0:v.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),f?{statement:f}:null));let e;if(Array.isArray(t)&&t[0]&&"object"==typeof t[0])e=t[0];else{if(!(t&&"object"==typeof t&&"signedMessage"in t&&"signature"in t))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");e=t}if(!("signedMessage"in e&&"signature"in e&&("string"==typeof e.signedMessage||e.signedMessage instanceof Uint8Array)&&e.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");y="string"==typeof e.signedMessage?e.signedMessage:(new TextDecoder).decode(e.signedMessage),p=e.signature}else{if(!("signMessage"in w&&"function"==typeof w.signMessage&&"publicKey"in w&&"object"==typeof w&&w.publicKey&&"toBase58"in w.publicKey&&"function"==typeof w.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${b.host} wants you to sign in with your Solana account:`,w.publicKey.toBase58(),...f?["",f,""]:[""],"Version: 1",`URI: ${b.href}`,`Issued At: ${null!==(r=null===(i=null==v?void 0:v.signInWithSolana)||void 0===i?void 0:i.issuedAt)&&void 0!==r?r:(new Date).toISOString()}`,...(null===(n=null==v?void 0:v.signInWithSolana)||void 0===n?void 0:n.notBefore)?[`Not Before: ${v.signInWithSolana.notBefore}`]:[],...(null===(s=null==v?void 0:v.signInWithSolana)||void 0===s?void 0:s.expirationTime)?[`Expiration Time: ${v.signInWithSolana.expirationTime}`]:[],...(null===(l=null==v?void 0:v.signInWithSolana)||void 0===l?void 0:l.chainId)?[`Chain ID: ${v.signInWithSolana.chainId}`]:[],...(null===(h=null==v?void 0:v.signInWithSolana)||void 0===h?void 0:h.nonce)?[`Nonce: ${v.signInWithSolana.nonce}`]:[],...(null===(u=null==v?void 0:v.signInWithSolana)||void 0===u?void 0:u.requestId)?[`Request ID: ${v.signInWithSolana.requestId}`]:[],...(null===(c=null===(a=null==v?void 0:v.signInWithSolana)||void 0===a?void 0:a.resources)||void 0===c?void 0:c.length)?["Resources",...v.signInWithSolana.resources.map(t=>`- ${t}`)]:[]].join("\n");const t=yield w.signMessage((new TextEncoder).encode(y),"utf8");if(!(t&&t instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=t}}try{const{data:e,error:i}=yield _(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:f(p)},(null===(d=t.options)||void 0===d?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null===(v=t.options)||void 0===v?void 0:v.captchaToken}}:null),xform:$});if(i)throw i;return e&&e.session&&e.user?(e.session&&(yield this.Mt(e.session),yield this.Ct("SIGNED_IN",e.session)),{data:Object.assign({},e),error:i}):{data:{user:null,session:null},error:new Xe}}catch(w){if(o(w))return{data:{user:null,session:null},error:w};throw w}})}Ht(t){return R(this,null,function*(){const e=yield di(this.storage,`${this.storageKey}-code-verifier`),[i,r]=(null!=e?e:"").split("/");try{const{data:e,error:n}=yield _(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:i},xform:$});if(yield fi(this.storage,`${this.storageKey}-code-verifier`),n)throw n;return e&&e.session&&e.user?(e.session&&(yield this.Mt(e.session),yield this.Ct("SIGNED_IN",e.session)),{data:Object.assign(Object.assign({},e),{redirectType:null!=r?r:null}),error:n}):{data:{user:null,session:null,redirectType:null},error:new Xe}}catch(n){if(o(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}})}signInWithIdToken(t){return R(this,null,function*(){try{const{options:e,provider:i,token:r,access_token:n,nonce:s}=t,o=yield _(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:r,access_token:n,nonce:s,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:$}),{data:l,error:h}=o;return h?{data:{user:null,session:null},error:h}:l&&l.session&&l.user?(l.session&&(yield this.Mt(l.session),yield this.Ct("SIGNED_IN",l.session)),{data:l,error:h}):{data:{user:null,session:null},error:new Xe}}catch(e){if(o(e))return{data:{user:null,session:null},error:e};throw e}})}signInWithOtp(t){return R(this,null,function*(){var e,i,r,n,s;try{if("email"in t){const{email:r,options:n}=t;let s=null,o=null;"pkce"===this.flowType&&([s,o]=yield p(this.storage,this.storageKey));const{error:l}=yield _(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(e=null==n?void 0:n.data)&&void 0!==e?e:{},create_user:null===(i=null==n?void 0:n.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:s,code_challenge_method:o},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:l}}if("phone"in t){const{phone:e,options:i}=t,{data:o,error:l}=yield _(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:e,data:null!==(r=null==i?void 0:i.data)&&void 0!==r?r:{},create_user:null===(n=null==i?void 0:i.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},channel:null!==(s=null==i?void 0:i.channel)&&void 0!==s?s:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:l}}throw new Qe("You must provide either an email or phone number.")}catch(l){if(o(l))return{data:{user:null,session:null},error:l};throw l}})}verifyOtp(t){return R(this,null,function*(){var e,i;try{let r,n;"options"in t&&(r=null===(e=t.options)||void 0===e?void 0:e.redirectTo,n=null===(i=t.options)||void 0===i?void 0:i.captchaToken);const{data:s,error:o}=yield _(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:n}}),redirectTo:r,xform:$});if(o)throw o;if(!s)throw new Error("An error occurred on token verification.");const l=s.session,h=s.user;return(null==l?void 0:l.access_token)&&(yield this.Mt(l),yield this.Ct("recovery"==t.type?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:h,session:l},error:null}}catch(r){if(o(r))return{data:{user:null,session:null},error:r};throw r}})}signInWithSSO(t){return R(this,null,function*(){var e,i,r;try{let n=null,s=null;return"pkce"===this.flowType&&([n,s]=yield p(this.storage,this.storageKey)),yield _(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:null!==(i=null===(e=t.options)||void 0===e?void 0:e.redirectTo)&&void 0!==i?i:void 0}),(null===(r=null==t?void 0:t.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:s}),headers:this.headers,xform:O})}catch(n){if(o(n))return{data:null,error:n};throw n}})}reauthenticate(){return R(this,null,function*(){return yield this.initializePromise,yield this.Dt(-1,()=>R(this,null,function*(){return yield this.Vt()}))})}Vt(){return R(this,null,function*(){try{return yield this.Kt(t=>R(this,null,function*(){const{data:{session:e},error:i}=t;if(i)throw i;if(!e)throw new Ye;const{error:r}=yield _(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:r}}))}catch(t){if(o(t))return{data:{user:null,session:null},error:t};throw t}})}resend(t){return R(this,null,function*(){try{const e=`${this.url}/resend`;if("email"in t){const{email:i,type:r,options:n}=t,{error:s}=yield _(this.fetch,"POST",e,{headers:this.headers,body:{email:i,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:s}}if("phone"in t){const{phone:i,type:r,options:n}=t,{data:s,error:o}=yield _(this.fetch,"POST",e,{headers:this.headers,body:{phone:i,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==s?void 0:s.message_id},error:o}}throw new Qe("You must provide either an email or phone number and a type")}catch(e){if(o(e))return{data:{user:null,session:null},error:e};throw e}})}getSession(){return R(this,null,function*(){return yield this.initializePromise,yield this.Dt(-1,()=>R(this,null,function*(){return this.Kt(t=>R(this,null,function*(){return t}))}))})}Dt(t,e){return R(this,null,function*(){this.Nt("#_acquireLock","begin",t);try{if(this.lockAcquired){const t=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(()=>R(this,null,function*(){return yield t,yield e()}))();return this.pendingInLock.push((()=>R(this,null,function*(){try{yield i}catch(t){}}))()),i}return yield this.lock(`lock:${this.storageKey}`,t,()=>R(this,null,function*(){this.Nt("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const t=e();for(this.pendingInLock.push((()=>R(this,null,function*(){try{yield t}catch(e){}}))()),yield t;this.pendingInLock.length;){const t=[...this.pendingInLock];yield Promise.all(t),this.pendingInLock.splice(0,t.length)}return yield t}finally{this.Nt("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this.Nt("#_acquireLock","end")}})}Kt(t){return R(this,null,function*(){this.Nt("#_useSession","begin");try{const e=yield this.Yt();return yield t(e)}finally{this.Nt("#_useSession","end")}})}Yt(){return R(this,null,function*(){this.Nt("#__loadSession()","begin"),this.lockAcquired||this.Nt("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let t=null;const e=yield di(this.storage,this.storageKey);if(this.Nt("#getSession()","session from storage",e),null!==e&&(this.Xt(e)?t=e:(this.Nt("#getSession()","session from storage is not valid"),yield this.Wt())),!t)return{data:{session:null},error:null};const i=!!t.expires_at&&9e4>1e3*t.expires_at-Date.now();if(this.Nt("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",t.expires_at),!i){if(this.userStorage){const e=yield di(this.userStorage,this.storageKey+"-user");(null==e?void 0:e.user)?t.user=e.user:t.user=b()}if(this.storage.isServer&&t.user){let e=this.suppressGetSessionWarning;t=new Proxy(t,{get:(t,i,r)=>(e||"user"!==i||(e=!0,this.suppressGetSessionWarning=!0),Reflect.get(t,i,r))})}return{data:{session:t},error:null}}const{session:r,error:n}=yield this.Qt(t.refresh_token);return n?{data:{session:null},error:n}:{data:{session:r},error:null}}finally{this.Nt("#__loadSession()","end")}})}getUser(t){return R(this,null,function*(){return t?yield this.Zt(t):(yield this.initializePromise,yield this.Dt(-1,()=>R(this,null,function*(){return yield this.Zt()})))})}Zt(t){return R(this,null,function*(){try{return t?yield _(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:k}):yield this.Kt(t=>R(this,null,function*(){var e,i,r;const{data:n,error:s}=t;if(s)throw s;return(null===(e=n.session)||void 0===e?void 0:e.access_token)||this.hasCustomAuthorizationHeader?yield _(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(i=n.session)||void 0===i?void 0:i.access_token)&&void 0!==r?r:void 0,xform:k}):{data:{user:null},error:new Ye}}))}catch(e){if(o(e))return(t=>o(t)&&"AuthSessionMissingError"===t.name)(e)&&(yield this.Wt(),yield fi(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:e};throw e}})}updateUser(t){return R(this,arguments,function*(t,e={}){return yield this.initializePromise,yield this.Dt(-1,()=>R(this,null,function*(){return yield this.te(t,e)}))})}te(t){return R(this,arguments,function*(t,e={}){try{return yield this.Kt(i=>R(this,null,function*(){const{data:r,error:n}=i;if(n)throw n;if(!r.session)throw new Ye;const s=r.session;let o=null,l=null;"pkce"===this.flowType&&null!=t.email&&([o,l]=yield p(this.storage,this.storageKey));const{data:h,error:u}=yield _(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==e?void 0:e.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:l}),jwt:s.access_token,xform:k});if(u)throw u;return s.user=h.user,yield this.Mt(s),yield this.Ct("USER_UPDATED",s),{data:{user:s.user},error:null}}))}catch(i){if(o(i))return{data:{user:null},error:i};throw i}})}setSession(t){return R(this,null,function*(){return yield this.initializePromise,yield this.Dt(-1,()=>R(this,null,function*(){return yield this.ee(t)}))})}ee(t){return R(this,null,function*(){try{if(!t.access_token||!t.refresh_token)throw new Ye;const e=Date.now()/1e3;let i=e,r=!0,n=null;const{payload:s}=v(t.access_token);if(s.exp&&(i=s.exp,r=e>=i),r){const{session:e,error:i}=yield this.Qt(t.refresh_token);if(i)return{data:{user:null,session:null},error:i};if(!e)return{data:{user:null,session:null},error:null};n=e}else{const{data:r,error:s}=yield this.Zt(t.access_token);if(s)throw s;n={access_token:t.access_token,refresh_token:t.refresh_token,user:r.user,token_type:"bearer",expires_in:i-e,expires_at:i},yield this.Mt(n),yield this.Ct("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(e){if(o(e))return{data:{session:null,user:null},error:e};throw e}})}refreshSession(t){return R(this,null,function*(){return yield this.initializePromise,yield this.Dt(-1,()=>R(this,null,function*(){return yield this.ie(t)}))})}ie(t){return R(this,null,function*(){try{return yield this.Kt(e=>R(this,null,function*(){var i;if(!t){const{data:r,error:n}=e;if(n)throw n;t=null!==(i=r.session)&&void 0!==i?i:void 0}if(!(null==t?void 0:t.refresh_token))throw new Ye;const{session:r,error:n}=yield this.Qt(t.refresh_token);return n?{data:{user:null,session:null},error:n}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}))}catch(e){if(o(e))return{data:{user:null,session:null},error:e};throw e}})}Jt(t,e){return R(this,null,function*(){try{if(!li())throw new Ze("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Ze(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if("pkce"===this.flowType)throw new ti("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Ze("Not a valid implicit grant flow url.")}if("pkce"===e){if(this.Nt("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new ti("No code detected.");const{data:e,error:i}=yield this.Ht(t.code);if(i)throw i;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:e.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:r,access_token:n,refresh_token:s,expires_in:o,expires_at:l,token_type:h}=t;if(!(n&&o&&s&&h))throw new Ze("No session defined in URL");const u=Math.round(Date.now()/1e3),a=parseInt(o);let c=u+a;l&&(c=parseInt(l));const{data:d,error:f}=yield this.Zt(n);if(f)throw f;const v={provider_token:i,provider_refresh_token:r,access_token:n,expires_in:a,expires_at:c,refresh_token:s,token_type:h,user:d.user};return window.location.hash="",this.Nt("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:t.type},error:null}}catch(i){if(o(i))return{data:{session:null,redirectType:null},error:i};throw i}})}Bt(t){return Boolean(t.access_token||t.error_description)}Ft(t){return R(this,null,function*(){const e=yield di(this.storage,`${this.storageKey}-code-verifier`);return!(!t.code||!e)})}signOut(){return R(this,arguments,function*(t={scope:"global"}){return yield this.initializePromise,yield this.Dt(-1,()=>R(this,null,function*(){return yield this.re(t)}))})}re(){return R(this,arguments,function*({scope:t}={scope:"global"}){return yield this.Kt(e=>R(this,null,function*(){var i;const{data:r,error:n}=e;if(n)return{error:n};const s=null===(i=r.session)||void 0===i?void 0:i.access_token;if(s){const{error:e}=yield this.admin.signOut(s,t);if(e&&(!(t=>o(t)&&"AuthApiError"===t.name)(e)||404!==e.status&&401!==e.status&&403!==e.status))return{error:e}}return"others"!==t&&(yield this.Wt(),yield fi(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))})}onAuthStateChange(t){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),i={id:e,callback:t,unsubscribe:()=>{this.Nt("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this.Nt("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,i),(()=>{R(this,null,function*(){yield this.initializePromise,yield this.Dt(-1,()=>R(this,null,function*(){this.ne(e)}))})})(),{data:{subscription:i}}}ne(t){return R(this,null,function*(){return yield this.Kt(e=>R(this,null,function*(){var i,r;try{const{data:{session:r},error:n}=e;if(n)throw n;yield null===(i=this.stateChangeEmitters.get(t))||void 0===i?void 0:i.callback("INITIAL_SESSION",r),this.Nt("INITIAL_SESSION","callback id",t,"session",r)}catch(n){yield null===(r=this.stateChangeEmitters.get(t))||void 0===r?void 0:r.callback("INITIAL_SESSION",null),this.Nt("INITIAL_SESSION","callback id",t,"error",n)}}))})}resetPasswordForEmail(t){return R(this,arguments,function*(t,e={}){let i=null,r=null;"pkce"===this.flowType&&([i,r]=yield p(this.storage,this.storageKey,!0));try{return yield _(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:i,code_challenge_method:r,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(n){if(o(n))return{data:null,error:n};throw n}})}getUserIdentities(){return R(this,null,function*(){var t;try{const{data:e,error:i}=yield this.getUser();if(i)throw i;return{data:{identities:null!==(t=e.user.identities)&&void 0!==t?t:[]},error:null}}catch(e){if(o(e))return{data:null,error:e};throw e}})}linkIdentity(t){return R(this,null,function*(){var e;try{const{data:i,error:r}=yield this.Kt(e=>R(this,null,function*(){var i,r,n,s,o;const{data:l,error:h}=e;if(h)throw h;const u=yield this.se(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:null===(i=t.options)||void 0===i?void 0:i.redirectTo,scopes:null===(r=t.options)||void 0===r?void 0:r.scopes,queryParams:null===(n=t.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return yield _(this.fetch,"GET",u,{headers:this.headers,jwt:null!==(o=null===(s=l.session)||void 0===s?void 0:s.access_token)&&void 0!==o?o:void 0})}));if(r)throw r;return li()&&!(null===(e=t.options)||void 0===e?void 0:e.skipBrowserRedirect)&&window.location.assign(null==i?void 0:i.url),{data:{provider:t.provider,url:null==i?void 0:i.url},error:null}}catch(i){if(o(i))return{data:{provider:t.provider,url:null},error:i};throw i}})}unlinkIdentity(t){return R(this,null,function*(){try{return yield this.Kt(e=>R(this,null,function*(){var i,r;const{data:n,error:s}=e;if(s)throw s;return yield _(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(i=n.session)||void 0===i?void 0:i.access_token)&&void 0!==r?r:void 0})}))}catch(e){if(o(e))return{data:null,error:e};throw e}})}oe(t){return R(this,null,function*(){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this.Nt(e,"begin");try{const i=Date.now();return yield function(t,e){return new Promise((i,r)=>{(()=>{R(this,null,function*(){for(let s=0;1/0>s;s++)try{const r=yield t(s);if(!e(s,null))return void i(r)}catch(n){if(!e(s,n))return void r(n)}})})()})}(i=>R(this,null,function*(){return i>0&&(yield function(t){return R(this,null,function*(){return yield new Promise(e=>{setTimeout(()=>e(null),t)})})}(200*Math.pow(2,i-1))),this.Nt(e,"refreshing attempt",i),yield _(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:$})}),(t,e)=>{const r=200*Math.pow(2,t);return e&&l(e)&&Date.now()+r-i<Je})}catch(i){if(this.Nt(e,"error",i),o(i))return{data:{session:null,user:null},error:i};throw i}finally{this.Nt(e,"end")}})}Xt(t){return"object"==typeof t&&null!==t&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}zt(t,e){return R(this,null,function*(){const i=yield this.se(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this.Nt("#_handleProviderSignIn()","provider",t,"options",e,"url",i),li()&&!e.skipBrowserRedirect&&window.location.assign(i),{data:{provider:t,url:i},error:null}})}Gt(){return R(this,null,function*(){var t,e;const i="#_recoverAndRefresh()";this.Nt(i,"begin");try{const n=yield di(this.storage,this.storageKey);if(n&&this.userStorage){let e=yield di(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||e||(e={user:n.user},yield ci(this.userStorage,this.storageKey+"-user",e)),n.user=null!==(t=null==e?void 0:e.user)&&void 0!==t?t:b()}else if(n&&!n.user&&!n.user){const t=yield di(this.storage,this.storageKey+"-user");t&&(null==t?void 0:t.user)?(n.user=t.user,yield fi(this.storage,this.storageKey+"-user"),yield ci(this.storage,this.storageKey,n)):n.user=b()}if(this.Nt(i,"session from storage",n),!this.Xt(n))return this.Nt(i,"session is not valid"),void(null!==n&&(yield this.Wt()));const s=9e4>1e3*(null!==(e=n.expires_at)&&void 0!==e?e:1/0)-Date.now();if(this.Nt(i,`session has${s?"":" not"} expired with margin of 90000s`),s){if(this.autoRefreshToken&&n.refresh_token){const{error:t}=yield this.Qt(n.refresh_token);t&&(l(t)||(this.Nt(i,"refresh failed with a non-retryable error, removing the session",t),yield this.Wt()))}}else if(n.user&&!0===n.user.le)try{const{data:t,error:e}=yield this.Zt(n.access_token);!e&&(null==t?void 0:t.user)?(n.user=t.user,yield this.Mt(n),yield this.Ct("SIGNED_IN",n)):this.Nt(i,"could not get user data, skipping SIGNED_IN notification")}catch(r){this.Nt(i,"error getting user data, skipping SIGNED_IN notification",r)}else yield this.Ct("SIGNED_IN",n)}catch(n){return void this.Nt(i,"error",n)}finally{this.Nt(i,"end")}})}Qt(t){return R(this,null,function*(){var e,i;if(!t)throw new Ye;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${t.substring(0,5)}...)`;this.Nt(r,"begin");try{this.refreshingDeferred=new vi;const{data:e,error:i}=yield this.oe(t);if(i)throw i;if(!e.session)throw new Ye;yield this.Mt(e.session),yield this.Ct("TOKEN_REFRESHED",e.session);const r={session:e.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(n){if(this.Nt(r,"error",n),o(n)){const t={session:null,error:n};return l(n)||(yield this.Wt()),null===(e=this.refreshingDeferred)||void 0===e||e.resolve(t),t}throw null===(i=this.refreshingDeferred)||void 0===i||i.reject(n),n}finally{this.refreshingDeferred=null,this.Nt(r,"end")}})}Ct(t,e,i=!0){return R(this,null,function*(){const r=`#_notifyAllSubscribers(${t})`;this.Nt(r,"begin",e,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:t,session:e});const r=[],n=Array.from(this.stateChangeEmitters.values()).map(i=>R(this,null,function*(){try{yield i.callback(t,e)}catch(n){r.push(n)}}));if(yield Promise.all(n),r.length>0){for(let t=0;t<r.length;t+=1);throw r[0]}}finally{this.Nt(r,"end")}})}Mt(t){return R(this,null,function*(){this.Nt("#_saveSession()",t),this.suppressGetSessionWarning=!0;const e=Object.assign({},t),i=e.user&&!0===e.user.le;if(this.userStorage){!i&&e.user&&(yield ci(this.userStorage,this.storageKey+"-user",{user:e.user}));const t=Object.assign({},e);delete t.user;const r=g(t);yield ci(this.storage,this.storageKey,r)}else{const t=g(e);yield ci(this.storage,this.storageKey,t)}})}Wt(){return R(this,null,function*(){this.Nt("#_removeSession()"),yield fi(this.storage,this.storageKey),yield fi(this.storage,this.storageKey+"-code-verifier"),yield fi(this.storage,this.storageKey+"-user"),this.userStorage&&(yield fi(this.userStorage,this.storageKey+"-user")),yield this.Ct("SIGNED_OUT",null)})}he(){this.Nt("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&li()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(e){}}ue(){return R(this,null,function*(){yield this.ae(),this.Nt("#_startAutoRefresh()");const t=setInterval(()=>this.ce(),Je);this.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout(()=>R(this,null,function*(){yield this.initializePromise,yield this.ce()}),0)})}ae(){return R(this,null,function*(){this.Nt("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)})}startAutoRefresh(){return R(this,null,function*(){this.he(),yield this.ue()})}stopAutoRefresh(){return R(this,null,function*(){this.he(),yield this.ae()})}ce(){return R(this,null,function*(){this.Nt("#_autoRefreshTokenTick()","begin");try{yield this.Dt(0,()=>R(this,null,function*(){try{const e=Date.now();try{return yield this.Kt(t=>R(this,null,function*(){const{data:{session:i}}=t;if(!i||!i.refresh_token||!i.expires_at)return void this.Nt("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*i.expires_at-e)/Je);this.Nt("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r>3||(yield this.Qt(i.refresh_token))}))}catch(t){}}finally{this.Nt("#_autoRefreshTokenTick()","end")}}))}catch(t){if(!(t.isAcquireTimeout||t instanceof $i))throw t;this.Nt("auto refresh token tick lock not available")}})}qt(){return R(this,null,function*(){if(this.Nt("#_handleVisibilityChange()"),!li()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>R(this,null,function*(){return yield this.de(!1)}),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this.de(!0)}catch(t){}})}de(t){return R(this,null,function*(){const e=`#_onVisibilityChanged(${t})`;this.Nt(e,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this.ue(),t||(yield this.initializePromise,yield this.Dt(-1,()=>R(this,null,function*(){"visible"===document.visibilityState?yield this.Gt():this.Nt(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this.ae()})}se(t,e,i){return R(this,null,function*(){const r=[`provider=${encodeURIComponent(e)}`];if((null==i?void 0:i.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),(null==i?void 0:i.scopes)&&r.push(`scopes=${encodeURIComponent(i.scopes)}`),"pkce"===this.flowType){const[t,e]=yield p(this.storage,this.storageKey),i=new URLSearchParams({code_challenge:`${encodeURIComponent(t)}`,code_challenge_method:`${encodeURIComponent(e)}`});r.push(i.toString())}if(null==i?void 0:i.queryParams){const t=new URLSearchParams(i.queryParams);r.push(t.toString())}return(null==i?void 0:i.skipBrowserRedirect)&&r.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${t}?${r.join("&")}`})}It(t){return R(this,null,function*(){try{return yield this.Kt(e=>R(this,null,function*(){var i;const{data:r,error:n}=e;return n?{data:null,error:n}:yield _(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:null===(i=null==r?void 0:r.session)||void 0===i?void 0:i.access_token})}))}catch(e){if(o(e))return{data:null,error:e};throw e}})}At(t){return R(this,null,function*(){try{return yield this.Kt(e=>R(this,null,function*(){var i,r;const{data:n,error:s}=e;if(s)return{data:null,error:s};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},"phone"===t.factorType?{phone:t.phone}:{issuer:t.issuer}),{data:l,error:h}=yield _(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(i=null==n?void 0:n.session)||void 0===i?void 0:i.access_token});return h?{data:null,error:h}:("totp"===t.factorType&&(null===(r=null==l?void 0:l.totp)||void 0===r?void 0:r.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})}))}catch(e){if(o(e))return{data:null,error:e};throw e}})}xt(t){return R(this,null,function*(){return this.Dt(-1,()=>R(this,null,function*(){try{return yield this.Kt(e=>R(this,null,function*(){var i;const{data:r,error:n}=e;if(n)return{data:null,error:n};const{data:s,error:o}=yield _(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:null===(i=null==r?void 0:r.session)||void 0===i?void 0:i.access_token});return o?{data:null,error:o}:(yield this.Mt(Object.assign({expires_at:Math.round(Date.now()/1e3)+s.expires_in},s)),yield this.Ct("MFA_CHALLENGE_VERIFIED",s),{data:s,error:o})}))}catch(e){if(o(e))return{data:null,error:e};throw e}}))})}Pt(t){return R(this,null,function*(){return this.Dt(-1,()=>R(this,null,function*(){try{return yield this.Kt(e=>R(this,null,function*(){var i;const{data:r,error:n}=e;return n?{data:null,error:n}:yield _(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:null===(i=null==r?void 0:r.session)||void 0===i?void 0:i.access_token})}))}catch(e){if(o(e))return{data:null,error:e};throw e}}))})}Rt(t){return R(this,null,function*(){const{data:e,error:i}=yield this.Pt({factorId:t.factorId});return i?{data:null,error:i}:yield this.xt({factorId:t.factorId,challengeId:e.id,code:t.code})})}St(){return R(this,null,function*(){const{data:{user:t},error:e}=yield this.getUser();if(e)return{data:null,error:e};const i=(null==t?void 0:t.factors)||[],r=i.filter(t=>"totp"===t.factor_type&&"verified"===t.status),n=i.filter(t=>"phone"===t.factor_type&&"verified"===t.status);return{data:{all:i,totp:r,phone:n},error:null}})}Ut(){return R(this,null,function*(){return this.Dt(-1,()=>R(this,null,function*(){return yield this.Kt(t=>R(this,null,function*(){var e,i;const{data:{session:r},error:n}=t;if(n)return{data:null,error:n};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=v(r.access_token);let o=null;s.aal&&(o=s.aal);let l=o;return(null!==(i=null===(e=r.user.factors)||void 0===e?void 0:e.filter(t=>"verified"===t.status))&&void 0!==i?i:[]).length>0&&(l="aal2"),{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:s.amr||[]},error:null}}))}))})}fetchJwk(t){return R(this,arguments,function*(t,e={keys:[]}){let i=e.keys.find(e=>e.kid===t);if(i)return i;const r=Date.now();if(i=this.jwks.keys.find(e=>e.kid===t),i&&this.jwks_cached_at+6e5>r)return i;const{data:n,error:s}=yield _(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(s)throw s;return n.keys&&0!==n.keys.length?(this.jwks=n,this.jwks_cached_at=r,i=n.keys.find(e=>e.kid===t),i||null):null})}getClaims(t){return R(this,arguments,function*(t,e={}){try{let i=t;if(!i){const{data:t,error:e}=yield this.getSession();if(e||!t.session)return{data:null,error:e};i=t.session.access_token}const{header:r,payload:n,signature:s,raw:{header:o,payload:l}}=v(i);(null==e?void 0:e.allowExpired)||(t=>{if(!t)throw new Error("Missing exp claim");if(Math.floor(Date.now()/1e3)>=t)throw new Error("JWT has expired")})(n.exp);const h=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?yield this.fetchJwk(r.kid,(null==e?void 0:e.keys)?{keys:e.keys}:null==e?void 0:e.jwks):null;if(!h){const{error:t}=yield this.getUser(i);if(t)throw t;return{data:{claims:n,header:r,signature:s},error:null}}const u=(t=>{switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}})(r.alg),a=yield crypto.subtle.importKey("jwk",h,u,!0,["verify"]);if(!(yield crypto.subtle.verify(u,a,s,(t=>{const e=[];return((t,e)=>{for(let i=0;i<t.length;i+=1){let r=t.charCodeAt(i);if(r>55295&&56319>=r){const e=1024*(r-55296)&65535;r=65536+(t.charCodeAt(i+1)-56320&65535|e),i+=1}c(r,e)}})(t,t=>e.push(t)),new Uint8Array(e)})(`${o}.${l}`))))throw new ri("Invalid JWT signature");return{data:{claims:n,header:r,signature:s},error:null}}catch(i){if(o(i))return{data:null,error:i};throw i}})}}Si.nextInstanceID=0;const Ti=Si;class Ei extends Ti{constructor(t){super(t)}}class xi{constructor(t,e,i){var r,n,s;if(this.supabaseUrl=t,this.supabaseKey=e,!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");const o=(l=t).endsWith("/")?l:l+"/";var l;const h=new URL(o);this.realtimeUrl=new URL("realtime/v1",h),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",h),this.storageUrl=new URL("storage/v1",h),this.functionsUrl=new URL("functions/v1",h);const u=`sb-${h.hostname.split(".")[0]}-auth-token`,a=function(t,e){var i,r;const{db:n,auth:s,realtime:o,global:l}=t,{db:h,auth:u,realtime:a,global:c}=e,d={db:Object.assign(Object.assign({},h),n),auth:Object.assign(Object.assign({},u),s),realtime:Object.assign(Object.assign({},a),o),storage:{},global:Object.assign(Object.assign(Object.assign({},c),l),{headers:Object.assign(Object.assign({},null!==(i=null==c?void 0:c.headers)&&void 0!==i?i:{}),null!==(r=null==l?void 0:l.headers)&&void 0!==r?r:{})}),accessToken:()=>{return t=this,i=function*(){return""},new((e=void 0)||(e=Promise))((r,n)=>{function s(t){try{l(i.next(t))}catch(e){n(e)}}function o(t){try{l(i.throw(t))}catch(e){n(e)}}function l(t){var i;t.done?r(t.value):(i=t.value,i instanceof e?i:new e(t=>{t(i)})).then(s,o)}l((i=i.apply(t,[])).next())});var t,e,i}};return t.accessToken?d.accessToken=t.accessToken:delete d.accessToken,d}(null!=i?i:{},{db:De,realtime:Be,auth:Object.assign(Object.assign({},Le),{storageKey:u}),global:Ce});this.storageKey=null!==(r=a.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(n=a.global.headers)&&void 0!==n?n:{},a.accessToken?(this.accessToken=a.accessToken,this.auth=new Proxy({},{get(t,e){throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(e)} is not possible`)}})):this.auth=this.fe(null!==(s=a.auth)&&void 0!==s?s:{},this.headers,a.global.fetch),this.fetch=((t,e,i)=>{const r=(t=>{let e;return e=t||("undefined"==typeof fetch?Y:fetch),(...t)=>e(...t)})(i),n="undefined"==typeof Headers?X:Headers;return(i,s)=>{return l=function*(){var o;const l=null!==(o=yield e())&&void 0!==o?o:t;let h=new n(null==s?void 0:s.headers);return h.has("apikey")||h.set("apikey",t),h.has("Authorization")||h.set("Authorization",`Bearer ${l}`),r(i,Object.assign(Object.assign({},s),{headers:h}))},new((o=void 0)||(o=Promise))((t,e)=>{function i(t){try{n(l.next(t))}catch(i){e(i)}}function r(t){try{n(l.throw(t))}catch(i){e(i)}}function n(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o(t=>{t(n)})).then(i,r)}n((l=l.apply(void 0,[])).next())});var o,l}})(e,this.ve.bind(this),a.global.fetch),this.realtime=this.ye(Object.assign({headers:this.headers,accessToken:this.ve.bind(this)},a.realtime)),this.rest=new At(new URL("rest/v1",h).href,{headers:this.headers,schema:a.db.schema,fetch:this.fetch}),this.storage=new Ue(this.storageUrl.href,this.headers,this.fetch,null==i?void 0:i.storage),a.accessToken||this.pe()}get functions(){return new J(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},i={}){return this.rest.rpc(t,e,i)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}ve(){var t,e,i,r,n;return i=this,n=function*(){if(this.accessToken)return yield this.accessToken();const{data:i}=yield this.auth.getSession();return null!==(e=null===(t=i.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:this.supabaseKey},new((r=void 0)||(r=Promise))((t,e)=>{function s(t){try{l(n.next(t))}catch(i){e(i)}}function o(t){try{l(n.throw(t))}catch(i){e(i)}}function l(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r(t=>{t(i)})).then(s,o)}l((n=n.apply(i,[])).next())})}fe({autoRefreshToken:t,persistSession:e,detectSessionInUrl:i,storage:r,storageKey:n,flowType:s,lock:o,debug:l},h,u){const a={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ei({url:this.authUrl.href,headers:Object.assign(Object.assign({},a),h),storageKey:n,autoRefreshToken:t,persistSession:e,detectSessionInUrl:i,storage:r,flowType:s,lock:o,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}ye(t){return new ge(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},null==t?void 0:t.params)}))}pe(){return this.auth.onAuthStateChange((t,e)=>{this.we(t,"CLIENT",null==e?void 0:e.access_token)})}we(t,e,i){"TOKEN_REFRESHED"!==t&&"SIGNED_IN"!==t||this.changedAccessToken===i?"SIGNED_OUT"===t&&(this.realtime.setAuth(),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=i}}const Ai=(t,e,i)=>new xi(t,e,i);(()=>{if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const t=process.version;if(null==t)return!1;const e=t.match(/^v(\d+)\./);e&&parseInt(e[1],10)})();export{Ai as c};

Paused on exception
x/</</</< - vendor-supabase-DDjLwgak.js:1:10047
Error: Acquiring an exclusive Navigator LockManager lock "lock:vgreviewapp-auth-token" immediately failed
